DIRECTORIES = @DIRECTORIES@

BUILD_DIR=build
PACKAGE_DIR= $(BUILD_DIR)/package

PACKAGE = $(BUILD_DIR)/@PACKAGE_NAME@-@PACKAGE_VERSION@_amd64.deb

.PHONY: all
all: $(DIRECTORIES) $(PACKAGE)

.PHONY: apps
apps: $(DIRECTORIES)

.PHONY: clean
clean:
	rm -rf build

.PHONY: $(DIRECTORIES)
$(DIRECTORIES):
	@$(MAKE) --keep-going --directory=$@ $(MAKECMDGOALS)

.PHONY: $(MAKECMDGOALS)
$(MAKECMDGOALS): $(DIRECTORIES)

# Rule to build debian .deb packages
%.deb:
	@mkdir -p $(PACKAGE_DIR)/DEBIAN
	@cp -r package/debian/control $(PACKAGE_DIR)/DEBIAN
	@mkdir -p $(@D)
	dpkg-deb --build $(PACKAGE_DIR) $@
	@rm -rf $(PACKAGE_DIR)/DEBIAN
