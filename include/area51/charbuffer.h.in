/* 
 * File:   charbuffer.h
 * Author: peter
 *
 * Created on February 11, 2014, 4:49 PM
 */

#ifndef AREA51_CHARBUFFER_H
#define	AREA51_CHARBUFFER_H

#include <pthread.h>
#include <stdio.h>
#include <stdarg.h>

#define CHARBUFFER_OK           0
#define CHARBUFFER_ERROR        1

#define CHARBUFFER_INITIAL_SIZE 1024

typedef struct charbuffer {
    // The current position in the buffer where new data will be appended
    int pos;
    // The actual size of the buffer in memory, not it's contents
    int size;
    // The actual memory being used by the buffer
    char *buffer;
    // mutex used to ensure the buffer is concurrent
    pthread_mutex_t mutex;
} CharBuffer;

extern int charbuffer_add(CharBuffer *b, char c);
extern int charbuffer_append(CharBuffer *b, char *src);
extern void charbuffer_appendbuffer(CharBuffer *dest, CharBuffer *src);
extern void charbuffer_free(CharBuffer *b);
extern int charbuffer_init(CharBuffer *b);
extern int charbuffer_printf(CharBuffer *b, char *fmt, ...);
extern int charbuffer_put(CharBuffer *b, char *src, int len);
extern void charbuffer_read(CharBuffer *b, FILE *in);
extern int charbuffer_readmem(CharBuffer *b, int fh);
extern void charbuffer_reset(CharBuffer *b);
extern int charbuffer_size(CharBuffer *b);
extern void *charbuffer_toarray(CharBuffer *b, int *len);
extern char *charbuffer_tostring(CharBuffer *b, int *len);

extern void charbuffer_append_int(CharBuffer *b, int v, int width);
extern void charbuffer_time_hm(CharBuffer *b, double t);
extern void charbuffer_time_hms(CharBuffer *b, double t);
extern int charbuffer_append_padleft(CharBuffer *b, char *src, int width);
extern int charbuffer_append_padright(CharBuffer *b, char *src, int width);
extern int charbuffer_append_center(CharBuffer *b, char *src, int width);

// JSON
extern void charbuffer_reset_json(CharBuffer *b);
extern void charbuffer_append_json(CharBuffer *b, char *n, char *fmt, ...);
extern void charbuffer_end_json(CharBuffer *b);

// XML
extern void charbuffer_reset_xml(CharBuffer *b, char *tag);
extern void charbuffer_append_xml(CharBuffer *b, char *n, char *fmt, ...);
extern void charbuffer_end_xml(CharBuffer *b, char *tag);

// Curl
extern int charbuffer_append_urlencode(CharBuffer *b, char *src);
extern int charbuffer_append_form_field(CharBuffer *b, char *name, char *value);
extern int charbuffer_append_form_fieldf(CharBuffer *b, char *name, char *fmt, ...);
#if @CURL@
extern size_t charbuffer_curl_write(void *b, size_t s, size_t n, void *stream);
extern size_t charbuffer_curl_write_sink(void *b, size_t s, size_t n, void *stream);
#endif

#endif	/* CHARBUFFER_H */

